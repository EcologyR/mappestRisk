<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Map pest risk — map_risk • mappestRisk</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Map pest risk — map_risk"><meta name="description" content="This function produces a raster map where each pixel shows the number of
months per year in which temperature is within a given set of bounds. If
the input has several pairs of minimum and maximum temperatures (as
produced by therm_suit_bounds()), the output raster has two layers: mean
and standard deviation."><meta property="og:description" content="This function produces a raster map where each pixel shows the number of
months per year in which temperature is within a given set of bounds. If
the input has several pairs of minimum and maximum temperatures (as
produced by therm_suit_bounds()), the output raster has two layers: mean
and standard deviation."><meta property="og:image" content="https://ecologyr.github.io/mappestRisk/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mappestRisk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/tpcs-model-fitting.html">TPCs model fitting</a></li>
    <li><a class="dropdown-item" href="../articles/tpcs-simulate-bootstrap.html">Simulate TPCs with bootstrap to propagate uncertainty</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EcologyR/mappestRisk/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Map pest risk</h1>
      <small class="dont-index">Source: <a href="https://github.com/EcologyR/mappestRisk/blob/main/R/map_risk.R" class="external-link"><code>R/map_risk.R</code></a></small>
      <div class="d-none name"><code>map_risk.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function produces a raster map where each pixel shows the number of
months per year in which temperature is within a given set of bounds. If
the input has several pairs of minimum and maximum temperatures (as
produced by <code><a href="therm_suit_bounds.html">therm_suit_bounds()</a></code>), the output raster has two layers: mean
and standard deviation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">map_risk</span><span class="op">(</span></span>
<span>  t_vals <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  t_rast <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  region <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mask <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  interactive <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-t-vals">t_vals<a class="anchor" aria-label="anchor" href="#arg-t-vals"></a></dt>
<dd><p>a <code>data.frame</code> or <code><a href="https://dplyr.tidyverse.org/reference/reexports.html" class="external-link">dplyr::tibble()</a></code> as produced by <code><a href="therm_suit_bounds.html">therm_suit_bounds()</a></code>.
<code>t_vals</code> must contain results derived from a single model.
It must contain at least one row of numeric values.
Additionally, the minimum ("left") thermal boundary or <code>tval_left</code>
must be lower than the maximum ("right") one, or <code>tval_right</code> for all rows.
Nominative columns must be present in the input (i.e., <code>model_name</code>,
<code>suitability</code>, <code>pred_suit</code> and <code>iter</code>).</p></dd>


<dt id="arg-t-rast">t_rast<a class="anchor" aria-label="anchor" href="#arg-t-rast"></a></dt>
<dd><p>Optional 12-layer <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">terra::SpatRaster()</a></code> with monthly mean
temperatures for the region of interest. If not provided, global
WorldClim raster layers will be automatically (down)loaded
using <code><a href="https://rdrr.io/pkg/geodata/man/worldclim.html" class="external-link">geodata::worldclim_global()</a></code>, and cropped to <code>region</code> (if provided).
Note that the download can be slow the first time you use the function in a new
<code>path</code>. If you get a download error, consider running e.g <code>options(timeout = 500)</code> (or more).</p></dd>


<dt id="arg-region">region<a class="anchor" aria-label="anchor" href="#arg-region"></a></dt>
<dd><p>Optional object specifying the region to map. Must overlap the
extent of <code>t_rast</code> if both are provided. Can be a <code><a href="https://rspatial.github.io/terra/reference/SpatVector-class.html" class="external-link">terra::SpatVector()</a></code>
polygon (obtained with <code><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">terra::vect()</a></code>); or an <code>sf</code> polygon,
in which case it will be coerced with <code><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">terra::vect()</a></code>) to a <code><a href="https://rspatial.github.io/terra/reference/SpatVector-class.html" class="external-link">terra::SpatVector()</a></code>;
or a character vector of country
name(s) in English (see <a href="country_names.html">country_names</a>), in which case climate maps will be
downloaded for those countries; or a <code><a href="https://rspatial.github.io/terra/reference/SpatExtent-class.html" class="external-link">terra::SpatExtent()</a></code> object (obtained with
<code><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">terra::ext()</a></code>); or a numeric vector of length 4 specifying the region
coordinates as follows: <code>c(xmin, xmax, ymin, ymax)</code>. The latter two must be in
the same CRS as<code>t_rast</code> if <code>t_rast</code> is provided, or in unprojected lon-lat
coordinates (WGS84, EPSG:4326) otherwise. If NULL, the output maps will
cover the entire <code>t_rast</code> if provided, or the entire world otherwise.</p></dd>


<dt id="arg-res">res<a class="anchor" aria-label="anchor" href="#arg-res"></a></dt>
<dd><p>Argument to pass to <code><a href="https://rdrr.io/pkg/geodata/man/worldclim.html" class="external-link">geodata::worldclim_global()</a></code> specifying
the spatial resolution for the raster maps to download, if <code>t_rast</code> is not
provided. The default is 2.5 arc-minutes. Beware that lower values (e.g., 0.5)
may lead to extremely heavy data sets and large computation times.</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Argument to pass to <code><a href="https://rdrr.io/pkg/geodata/man/worldclim.html" class="external-link">geodata::worldclim_global()</a></code> (if <code>t_rast</code>
is not provided) and/or to <code><a href="https://rdrr.io/pkg/geodata/man/world.html" class="external-link">geodata::world()</a></code> (if <code>region</code> is a vector of
country names) specifying the folder path for the downloaded maps.</p></dd>


<dt id="arg-mask">mask<a class="anchor" aria-label="anchor" href="#arg-mask"></a></dt>
<dd><p>Logical value to pass to <code><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">terra::mask()</a></code> specifying whether the
output raster maps should be masked with the borders of the target 'region',
if this is a polygon map or a vector of country names. The default is TRUE.
If FALSE, the entire rectangular extent of 'region' will be used.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical value specifying whether to display messages about
what the function is doing at possibly slow steps. The default is FALSE.
Setting it to TRUE can be useful for checking progress when maps are large.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Logical value specifying whether to plot the results in a map.
Defaults to TRUE. Note that the function will always return a <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">terra::SpatRaster()</a></code>
object even if <code>plot = TRUE</code>.</p></dd>


<dt id="arg-interactive">interactive<a class="anchor" aria-label="anchor" href="#arg-interactive"></a></dt>
<dd><p>Logical value specifying whether the plotted map should be
interactive (if plot=TRUE). The default is TRUE if the 'leaflet' package is installed.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>This function returns a <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">terra::SpatRaster()</a></code> with up to 2 layers:
the (<code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code>) number of months with temperature within the species' thermal
bounds; and (if <code>t_vals</code> has &gt;1 rows) the standard deviation (<code><a href="https://rdrr.io/r/stats/sd.html" class="external-link">stats::sd()</a></code>) around
that mean.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># interactive()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"aphid"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fitted_tpcs</span> <span class="op">&lt;-</span> <span class="fu"><a href="fit_devmodels.html">fit_devmodels</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">temperature</span>,</span></span>
<span class="r-in"><span>                             dev_rate <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">rate_value</span>,</span></span>
<span class="r-in"><span>                             model_name <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_devmodels.html">plot_devmodels</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">temperature</span>,</span></span>
<span class="r-in"><span>               dev_rate <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">rate_value</span>,</span></span>
<span class="r-in"><span>               fitted_parameters <span class="op">=</span> <span class="va">fitted_tpcs</span>,</span></span>
<span class="r-in"><span>               species <span class="op">=</span> <span class="st">"Brachycaudus schwartzi"</span>,</span></span>
<span class="r-in"><span>               life_stage <span class="op">=</span> <span class="st">"Nymphs"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Obtain prediction TPCs with bootstraps for propagating uncertainty:</span></span></span>
<span class="r-in"><span><span class="va">boot_tpcs</span> <span class="op">&lt;-</span> <span class="fu"><a href="predict_curves.html">predict_curves</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">temperature</span>,</span></span>
<span class="r-in"><span>                            dev_rate <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">rate_value</span>,</span></span>
<span class="r-in"><span>                            fitted_parameters <span class="op">=</span> <span class="va">fitted_tpcs</span>,</span></span>
<span class="r-in"><span>                            model_name_2boot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lactin2"</span>, <span class="st">"briere2"</span>, <span class="st">"beta"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            propagate_uncertainty <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                            n_boots_samples <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">boot_tpcs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot bootstrapped curves:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_uncertainties.html">plot_uncertainties</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">temperature</span>,</span></span>
<span class="r-in"><span>                   dev_rate <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">rate_value</span>,</span></span>
<span class="r-in"><span>                   bootstrap_tpcs <span class="op">=</span> <span class="va">boot_tpcs</span>,</span></span>
<span class="r-in"><span>                   species <span class="op">=</span> <span class="st">"Brachycaudus schwartzi"</span>,</span></span>
<span class="r-in"><span>                   life_stage <span class="op">=</span> <span class="st">"Nymphs"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate Q80 thermal bounds</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">boundaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="therm_suit_bounds.html">therm_suit_bounds</a></span><span class="op">(</span>preds_tbl <span class="op">=</span> <span class="va">boot_tpcs</span>,</span></span>
<span class="r-in"><span>                                model_name <span class="op">=</span> <span class="st">"lactin2"</span>,</span></span>
<span class="r-in"><span>                                suitability_threshold <span class="op">=</span> <span class="fl">80</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">boundaries</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract and Plot Risk maps</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># if you don't have temperature rasters for your region:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">risk_map_reunion</span> <span class="op">&lt;-</span> <span class="fu">map_risk</span><span class="op">(</span>t_vals <span class="op">=</span> <span class="va">boundaries</span>,</span></span>
<span class="r-in"><span>                             path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># directory to download data</span></span></span>
<span class="r-in"><span>                             region <span class="op">=</span> <span class="st">"Réunion"</span>,</span></span>
<span class="r-in"><span>                             mask <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                             plot <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                             interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                             verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you already have a raster of monthly average temperatures</span></span></span>
<span class="r-in"><span><span class="co"># for your region of interest, you can use that as input for `t_rast`:</span></span></span>
<span class="r-in"><span><span class="co">## first, load it</span></span></span>
<span class="r-in"><span><span class="va">tavg_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/tavg_reunion.tif"</span>, package <span class="op">=</span> <span class="st">"mappestRisk"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tavg_rast</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">tavg_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## then apply the function</span></span></span>
<span class="r-in"><span><span class="va">risk_map_reunion</span> <span class="op">&lt;-</span> <span class="fu">map_risk</span><span class="op">(</span>t_vals <span class="op">=</span> <span class="va">boundaries</span>,</span></span>
<span class="r-in"><span>                             t_rast <span class="op">=</span> <span class="va">tavg_rast</span>,</span></span>
<span class="r-in"><span>                             mask <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                             path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             plot <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                             interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                             verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using a spatial object for `region`</span></span></span>
<span class="r-in"><span><span class="va">sobrarbe</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/sobrarbe.gpkg"</span>,</span></span>
<span class="r-in"><span>                                   package <span class="op">=</span> <span class="st">"mappestRisk"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">risk_map_sobrarbe</span> <span class="op">&lt;-</span> <span class="fu">map_risk</span><span class="op">(</span>t_vals <span class="op">=</span> <span class="va">boundaries</span>,</span></span>
<span class="r-in"><span>                              region <span class="op">=</span> <span class="va">sobrarbe</span>,</span></span>
<span class="r-in"><span>                              path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                              mask <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                              plot <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                              interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                              verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Darío San-Segundo Molina, A. Márcia Barbosa, Antonio Jesús Pérez-Luque, Francisco Rodríguez-Sánchez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generating Risk Maps • mappestRisk</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generating Risk Maps">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mappestRisk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/generate-risk-maps.html">Generating Risk Maps</a></li>
    <li><a class="dropdown-item" href="../articles/tpcs-model-fitting.html">TPCs model fitting</a></li>
    <li><a class="dropdown-item" href="../articles/tpcs-simulate-bootstrap.html">Simulate TPCs with bootstrap to propagate uncertainty</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EcologyR/mappestRisk/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generating Risk Maps</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EcologyR/mappestRisk/blob/main/vignettes/articles/generate-risk-maps.Rmd" class="external-link"><code>vignettes/articles/generate-risk-maps.Rmd</code></a></small>
      <div class="d-none name"><code>generate-risk-maps.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EcologyR/mappestRisk" class="external-link">mappestRisk</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="generating-risk-maps-for-pest-development">Generating risk maps for pest development<a class="anchor" aria-label="anchor" href="#generating-risk-maps-for-pest-development"></a>
</h2>
<div class="section level3">
<h3 id="overall-approach-and-ecological-meaning">Overall approach and ecological meaning<a class="anchor" aria-label="anchor" href="#overall-approach-and-ecological-meaning"></a>
</h3>
<p><code>mappestRisk</code> aims to provide an easy-to-use modelling
workflow for producing pest risk maps.</p>
<p>Development rates variation across temperatures has been largely used
to produce risk maps of pest occurrence, usually maps of annual
generations for arthropod crop pests based on linear models (see e.g.,
<span class="citation">(Health (PLH) et al. 2017)</span>). Despite more
complex approaches have been recently used for pest risk assessment
based on biological responses to temperature<span class="citation">(Health (PLH) et al. 2023)</span>, nonlinear TPC
modelling of development rates variation across temperatures, already
available after decades of experimental data collection, can help inform
pest risk assessment throughout multiple crop pests<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;For theoretical insights on the relationship between
development rate TPCs and other population growth rates approximating
fitness, see &lt;span class="citation"&gt;(Pawar et al. 2024; Amarasekare and
Savage 2012)&lt;/span&gt;.&lt;/p&gt;'><sup>1</sup></a>.</p>
<p>The approach followed by <code>mappestRisk</code> is inspired by the
one developed by <span class="citation">Taylor et al. (2019)</span>.
These researchers compose a mathematical model through TPC model fitting
that describes the temperature-dependence of huanglongbing transmission
from <em>Diaphorina citri</em> to citrus plants. Given that this model
theoretically approximates the fundamental thermal niche of the species,
they project throughout citrus growing regions how many months per year
have average temperatures that result optimal for transmitting the
virus. This index (number of high risk months) results extremely helpful
for policy making, since it reduces sources of uncertainty in the
communication field by using a direct, applied measurement <span class="citation">(Simmonds et al. 2022)</span>.</p>
<p>Given the major contribution of development rate TPCs to ectotherms’
fitness<span class="citation">(Pawar et al. 2024; Amarasekare and Savage
2012)</span> and thus likely on fundamental thermal niche, here we
suggest applying a similar framework in a simpler way to calculate how
many months per year are optimal for a population to maximize its
development.</p>
</div>
<div class="section level3">
<h3 id="calculate-the-thermal-suitability-boundaries">Calculate the Thermal Suitability Boundaries<a class="anchor" aria-label="anchor" href="#calculate-the-thermal-suitability-boundaries"></a>
</h3>
<p>In order to obtain thermal suitability boundaries or limits defining
the TPC region where development is maximum, the package incorporates
the <code><a href="../reference/therm_suit_bounds.html">therm_suit_bounds()</a></code> function.</p>
<p>This function has as input the <code>tibble</code> obtained after
using the <code><a href="../reference/predict_curves.html">predict_curves()</a></code> function, either with- or
without uncertainty propagation. Note that only one model can be used
for calculating thermal suitability boundaries at a time. Additionally,
it has a <code>suitability_threshold</code> argument to allow the user
to specify which quantile of the TPC is being used. In other words, a
<code>suitability_threshold = .75</code> will calculate the two
temperature values at which the TPC predicts a value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mn>75</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0.75</mn><mo>×</mo><mspace width="0.222em"></mspace><msub><mi>r</mi><mo>max</mo></msub></mrow><annotation encoding="application/x-tex">R(T_{75}) = 0.75\times\ r_\max</annotation></semantics></math>
, one at each side of the TPC peak. If multiple TPCs are given due to
setting the <code><a href="../reference/predict_curves.html">predict_curves()</a></code> argument
<code>propagate_uncertainty</code> to <code>TRUE</code>, two boundaries
will be calculated for each TPC. This function outputs a
<code>tibble</code> with the thermal suitability boundaries for each
curve.</p>
<p>Note that setting <code>suitability_threshold</code> to
<code>0</code> will yield the thermal limits of the complete TPC, i.e.,
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>T</mi><mo>min</mo></msub></mrow><annotation encoding="application/x-tex">CT_\min</annotation></semantics></math>
and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>T</mi><mo>max</mo></msub></mrow><annotation encoding="application/x-tex">CT_\max</annotation></semantics></math>.
While the map resulting from default (.75) or similar threshold measures
indicates severe risk (populations may rapidly develop), maps from
permissive measures such as critical thermal limits may rather indicate
risk of the pest to find a refuge in the selected region.</p>
<p>Here we provide a example<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Warnings have been omitted to avoid overwhelming
information in the article, but they usually refer to TPC simulations
yielding &lt;code&gt;NA&lt;/code&gt; values for thermal suitability boundaries (see
“chopped” simulation curves in the &lt;code&gt;plot_uncertainty()&lt;/code&gt;
output in &lt;a href="articles/tpcs-simulate-bootstrap.html"&gt;Simulate TPCs
with bootstrap to propagate uncertainty&lt;/a&gt;article.&lt;/p&gt;'><sup>2</sup></a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#fit previously:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"aphid"</span><span class="op">)</span></span>
<span><span class="va">fitted_tpcs_aphid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_devmodels.html">fit_devmodels</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">temperature</span>,</span>
<span>                                   dev_rate <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">rate_value</span>,</span>
<span>                                   model_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"briere2"</span>, <span class="st">"lactin2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#predict curves previously</span></span>
<span><span class="va">preds_boots_aphid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_curves.html">predict_curves</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">temperature</span>,          </span>
<span>                                    dev_rate <span class="op">=</span> <span class="va">aphid</span><span class="op">$</span><span class="va">rate_value</span>,</span>
<span>                                    fitted_parameters <span class="op">=</span> <span class="va">fitted_tpcs_aphid</span>,</span>
<span>                                    model_name_2boot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"briere2"</span>, <span class="st">"lactin2"</span><span class="op">)</span>,</span>
<span>                                    propagate_uncertainty <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                    n_boots_samples <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">boundaries_aphid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/therm_suit_bounds.html">therm_suit_bounds</a></span><span class="op">(</span>preds_tbl <span class="op">=</span> <span class="va">preds_boots_aphid</span>,       </span>
<span>                                      model_name <span class="op">=</span> <span class="st">"lactin2"</span>,        </span>
<span>                                      suitability_threshold <span class="op">=</span> <span class="fl">80</span><span class="op">)</span> </span></code></pre></div>
<p>The output has the following aspect:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">boundaries_aphid</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 6</span></span></span>
<span><span class="co">#&gt;    model_name suitability tval_left tval_right pred_suit iter    </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> lactin2    80%              21         31.3     0.114 1       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> lactin2    80%              21.8       32.5     0.113 10      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> lactin2    80%              21.5       31.9     0.113 2       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> lactin2    80%              22.3       31.7     0.121 3       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> lactin2    80%              21.2       31.6     0.113 4       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> lactin2    80%              22.3       32.2     0.116 5       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> lactin2    80%              22.1       31.9     0.114 6       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> lactin2    80%              21.8       32.2     0.113 7       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> lactin2    80%              21.1       32.4     0.115 8       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> lactin2    80%              22.3       31.6     0.114 9       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> lactin2    80%              21.5       31.8     0.113 estimate</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="project-a-risk-map">Project a risk map<a class="anchor" aria-label="anchor" href="#project-a-risk-map"></a>
</h3>
<p>Given the fitted TPCs and their calculated suitability thermal
traits, <code>mappestRisk</code> enables to automatically generate
rasters –<code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">terra::SpatRaster</a></code>– at the targeting region to
forecast summarizing the number of months per year with highly suitable
temperatures for pest development.</p>
<p>This can be done with the function <code><a href="../reference/map_risk.html">map_risk()</a></code></p>
<p>The workflow of the function is as follows:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Extract temperature data:</strong> When no temperature
raster is provided by the user in the <code>t_rast</code> argument
(default <code>NULL</code>), <code><a href="../reference/map_risk.html">map_risk()</a></code> automatically
downloads temperature data from <a href="https://worldclim.org/data/worldclim21.html" class="external-link">WorldClim</a>
historical data set using <code>geodata</code> <span class="citation">(Hijmans et al. 2024)</span> package, consisting in
average temperature at monthly time resolution and a user-defined
spatial resolution through <code>res</code> argument –our function uses
2.5 resolution or ~4.625km at the equator by default. If the
<code>region</code> argument is a string with any country name available
in <code>data(country_names)</code>, the function calls
<code><a href="https://rdrr.io/pkg/geodata/man/worldclim.html" class="external-link">geodata::worldclim_country()</a></code>. Alternatively, if the
<code>region</code> argument is either a <code>SpatExtent</code>, a
vector with the numeric boundaries of this spatial extent or a
<code>sf</code> or <code>SpatVector</code> object –i.e., polygons, the
<code><a href="../reference/map_risk.html">map_risk()</a></code> function will download data for the entire world
using <code><a href="https://rdrr.io/pkg/geodata/man/worldclim.html" class="external-link">geodata::worldclim_global()</a></code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;We recommend to think carefully where to extract data
since a simple call to &lt;code&gt;&lt;a href="../reference/map_risk.html"&gt;map_risk()&lt;/a&gt;&lt;/code&gt; without a country name
will download ~450MB of climate data with default conditions
(&lt;code&gt;res = 2.5&lt;/code&gt;). Note that the &lt;code&gt;path&lt;/code&gt; argument must
be given by the user. If the user desires to save the temperature data
sourcing the map, this path should refer to somewhere in your device;
otherwise, a &lt;code&gt;&lt;a href="https://rdrr.io/r/base/tempfile.html" class="external-link"&gt;tempdir()&lt;/a&gt;&lt;/code&gt; is recommended to avoid large data
storage.&lt;/p&gt;'><sup>3</sup></a>.</li>
<li>
<strong>Spatial operations</strong>: Once the temperature raster is
available (either through user-input in <code>t_rast</code> or by
downloading from WorldClim), the <code><a href="../reference/map_risk.html">map_risk()</a></code> function
operates using <code>terra</code> R package for spatial operations such
as cropping the data to the target region spatial extent and masking (if
<code>mask = TRUE</code>). Next, <code><a href="../reference/map_risk.html">map_risk()</a></code> uses the input
of the argument <code>t_vals</code> –which has to be a
<code>tibble</code> exported from <code><a href="../reference/therm_suit_bounds.html">therm_suit_bounds()</a></code>– to
assign a value of <code>1</code> at those cells with monthly
temperatures within the interval given by
<code><a href="../reference/therm_suit_bounds.html">therm_suit_bounds()</a></code> or <code>0</code> if not, yielding a
raster with 12 layers (1 for each month) with <code>0</code>’s and
<code>1</code>’s. Then, it automatically sums those values for each cell
across the 12 layers to give a final <code>SpatRaster</code> with one
layer whose values vary between 0 or 12, indicating the number of months
per year with highly suitable temperatures –within the thermal
boundaries from <code><a href="../reference/therm_suit_bounds.html">therm_suit_bounds()</a></code> from TPC model fitting–
at that cell, or in other words, the <em>risk value</em>. When more than
one row is given in <code>t_vals</code> (due to multiple thermal
boundaries after propagating uncertainty with
<code><a href="../reference/predict_curves.html">predict_curves()</a></code>), one “partial” <code>SpatRaster</code> is
calculated by <code><a href="../reference/map_risk.html">map_risk()</a></code> for each pair of thermal
boundaries. In this case, a final <code>SpatRaster</code> is generated
with two values layers: the <em>Risk</em> layer that averages the
<em>risk</em> value across partial rasters and the <em>uncertainty</em>
raster that calculates the standard deviation across these partial
rasters as an uncertainty risk measurement.</li>
<li>
<strong>Visualization</strong>: despite the function yields a
<code>SpatRaster</code>, it automatically plots the map representing the
raster vallues whenever the <code>plot</code> argument is set to
<code>TRUE</code>. This map is generated using
<code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">terra::plot()</a></code> and will have one panel showing the risk
value –i.e., the <em>risk</em> raster layer– and, when parameter
uncertainty has been included in the complete <code>mappestRisk</code>
workflow, it will add a second panel showing the standard deviation of
the risk value in <code>acton</code> palette –i.e., the
<em>uncertainty</em> raster layer. Cells are coloured based on their
values using <em>bilbao</em> and <em>acton</em> palettes from
<code>khroma</code> package <span class="citation">(Frerebeau
2025)</span>.</li>
<li>
<strong>Interactive maps:</strong> <code><a href="../reference/map_risk.html">map_risk()</a></code> has an
additional logical argument called <code>interactive</code>, default to
<code>FALSE</code>. If set to <code>TRUE</code>, the output of
<code>map_risk</code> won’t be a <code>SpatRaster</code> any longer but
a <code>leaflet</code> object instead, and an interactive map with the
above-mentioned layers will be generated using
<code><a href="https://rspatial.github.io/terra/reference/plet.html" class="external-link">terra::plet()</a></code>.</li>
</ol>
<p>The following sections show how to obtain risk rasters with default
visualization given directly by <code><a href="../reference/map_risk.html">map_risk()</a></code>. Custom
alternatives for map visualization are detailed in <a href="articles/custom-risk-maps.html">Customize your Risk Maps</a>
article.</p>
</div>
<div class="section level3">
<h3 id="risk-map-country">Risk map: country<a class="anchor" aria-label="anchor" href="#risk-map-country"></a>
</h3>
<p>If we follow the workflow of the package in the examples elsewhere in
this website, we can then create a risk map for a country. In this
example, we will obtain it for Bhutan.</p>
<p>Since <em>Bhutan</em> is the official name included in
<code><a href="../reference/country_names.html">mappestRisk::country_names</a></code> and no <code>t_rast</code> is
given by the user, the function will automatically download data cropped
for this country. In this case, we will use</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Create a Risk Map for Bhutan</span></span>
<span></span>
<span><span class="va">risk_rast_bhutan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_risk.html">map_risk</a></span><span class="op">(</span>t_vals <span class="op">=</span> <span class="va">boundaries_aphid</span>, </span>
<span>                             path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># directory to download data </span></span>
<span>                             region <span class="op">=</span> <span class="st">"Bhutan"</span>,    </span>
<span>                             mask <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                             verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computing summary layers...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Plotting map...</span></span></code></pre>
<p><img src="generate-risk-maps_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Finished!</span></span></code></pre>
<p>The map on the left side shows how many months have optimal
temperatures for the aphid <em>Brachycaudus schwartzi</em> along Taiwan,
from 0 (in mountains and highlands) up to 9 (in southern lowlands). The
map on the right side shows an error map from parameter uncertainties,
with regions at which the risk estimate is exact (e.g., the mountains)
and others with up to 1.6 yielding the standard deviation of the risk
value (in <em>number of suitable months</em>) at specific cells.</p>
</div>
<div class="section level3">
<h3 id="risk-map-spatial-extent">Risk map: Spatial Extent<a class="anchor" aria-label="anchor" href="#risk-map-spatial-extent"></a>
</h3>
<p>In the following example, the <code>region</code> will be a frame
with four coordinates (<code>xmin, xmax, ymin, ymax</code>) encompassing
the Bhutan projection that is used by default in <code><a href="../reference/map_risk.html">map_risk()</a></code>
function. First, let’s convert the numeric extent into a
<code>SpatExtent</code> using <code><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">terra::ext()</a></code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that &lt;code&gt;&lt;a href="../reference/map_risk.html"&gt;map_risk()&lt;/a&gt;&lt;/code&gt; will also work for a
numeric vector with this four values, so using &lt;code&gt;&lt;a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link"&gt;terra::ext()&lt;/a&gt;&lt;/code&gt;
is not necessary and we use it for safety practices writing (it might
avoid typo data, etc).&lt;/p&gt;'><sup>4</sup></a>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bhutan_spatextent</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">risk_rast_bhutan</span><span class="op">)</span></span></code></pre></div>
<p>Then, we would apply the same function as before for the
<code>aphid</code> workflow, with the new <code>region</code> argument
set to <code>"bhutan_spatextent"</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">risk_rast_bhutan_v2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_risk.html">map_risk</a></span><span class="op">(</span>t_vals <span class="op">=</span> <span class="va">boundaries_aphid</span>, </span>
<span>                                path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># directory to download data </span></span>
<span>                                region <span class="op">=</span> <span class="va">bhutan_spatextent</span>,    </span>
<span>                                mask <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="risk-map-polygons">Risk map: Polygons<a class="anchor" aria-label="anchor" href="#risk-map-polygons"></a>
</h3>
<p>A typical scenario may involve forecasting data to regional or
province level, to natural protected areas or to crop’s growing regions.
In these cases, the user input for <code>region</code> must be an
<code>sf</code> object –e.g., by loading a shapefile (*<em>.shp)</em> in
R using <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::st_read()</a></code>– or as a <code>SpatVector</code>
–e.g., by loading a shapefile using <code><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">terra::vect()</a></code>. The
<code><a href="../reference/map_risk.html">map_risk()</a></code> function will automatically download global data
and crop it to the spatial extent of the object, and will perform a
masking operation if <code>mask = TRUE</code>.</p>
<p>In the following example, we will use it for Bhutan, as well. The
<code><a href="../reference/map_risk.html">map_risk()</a></code> function will automatically transform it for the
climate extraction and the procedure performs similar to the previous
examples:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bhutan_sf</span> <span class="op">&lt;-</span> <span class="va">worldmap_sf</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Bhutan"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">risk_rast_bhutan_sfexample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_risk.html">map_risk</a></span><span class="op">(</span>t_vals <span class="op">=</span> <span class="va">boundaries_aphid</span>, </span>
<span>                                       path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># directory to download data </span></span>
<span>                                       region <span class="op">=</span> <span class="va">bhutan_sf</span>,    </span>
<span>                                       mask <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                       plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                       interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                       verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-amarasekare2012" class="csl-entry">
Amarasekare, Priyanga, and Van Savage. 2012. <span>“A framework for
elucidating the temperature dependence of fitness.”</span> <em>The
American Naturalist</em> 179 (2): 178–91. <a href="https://doi.org/10.1086/663677" class="external-link">https://doi.org/10.1086/663677</a>.
</div>
<div id="ref-khroma" class="csl-entry">
Frerebeau, Nicolas. 2025. <span>“<span></span>Khroma: Colour Schemes for
Scientific Data Visualization<span></span>.”</span> <a href="https://doi.org/10.5281/zenodo.1472077" class="external-link">https://doi.org/10.5281/zenodo.1472077</a>.
</div>
<div id="ref-efsa2023" class="csl-entry">
Health (PLH), EFSA Panel on Plant, Claude Bragard, Paula Baptista,
Elisavet Chatzivassiliou, Francesco Di Serio, Paolo Gonthier, Josep
Anton Jaques Miret, et al. 2023. <span>“Assessment of the Probability of
Introduction of Thaumatotibia Leucotreta into the European Union with
Import of Cut Roses.”</span> <em>EFSA Journal</em> 21 (10): e08107. <a href="https://doi.org/10.2903/j.efsa.2023.8107" class="external-link">https://doi.org/10.2903/j.efsa.2023.8107</a>.
</div>
<div id="ref-efsa2017" class="csl-entry">
Health (PLH), EFSA Panel on Plant, Michael Jeger, Claude Bragard, David
Caffier, Thierry Candresse, Elisavet Chatzivassiliou, Katharina
Dehnen-Schmutz, et al. 2017. <span>“Pest Categorisation of Spodoptera
Frugiperda.”</span> <em>EFSA Journal</em> 15 (7): e04927. <a href="https://doi.org/10.2903/j.efsa.2017.4927" class="external-link">https://doi.org/10.2903/j.efsa.2017.4927</a>.
</div>
<div id="ref-hijmans2024" class="csl-entry">
Hijmans, Robert J., Márcia Barbosa, Aniruddha Ghosh, and Alex Mandel.
2024. <em>Geodata: Download Geographic Data</em>. <a href="https://cran.r-project.org/web/packages/geodata/index.html" class="external-link">https://cran.r-project.org/web/packages/geodata/index.html</a>.
</div>
<div id="ref-pawar2024" class="csl-entry">
Pawar, Samraat, Paul J. Huxley, Thomas R. C. Smallwood, Miles L. Nesbit,
Alex H. H. Chan, Marta S. Shocket, Leah R. Johnson, Dimitrios-Georgios
Kontopoulos, and Lauren J. Cator. 2024. <span>“Variation in Temperature
of Peak Trait Performance Constrains Adaptation of Arthropod Populations
to Climatic Warming.”</span> <em>Nature Ecology &amp; Evolution</em>,
January, 1–11. <a href="https://doi.org/10.1038/s41559-023-02301-8" class="external-link">https://doi.org/10.1038/s41559-023-02301-8</a>.
</div>
<div id="ref-simmonds2022" class="csl-entry">
Simmonds, Emily G., Kwaku Peprah Adjei, Christoffer Wold Andersen, Janne
Cathrin Hetle Aspheim, Claudia Battistin, Nicola Bulso, Hannah M.
Christensen, et al. 2022. <span>“Insights into the Quantification and
Reporting of Model-Related Uncertainty Across Different
Disciplines.”</span> <em>iScience</em> 25 (12): 105512. <a href="https://doi.org/10.1016/j.isci.2022.105512" class="external-link">https://doi.org/10.1016/j.isci.2022.105512</a>.
</div>
<div id="ref-taylor2019" class="csl-entry">
Taylor, Rachel A., Sadie J. Ryan, Catherine A. Lippi, David G. Hall,
Hossein A. Narouei-Khandan, Jason R. Rohr, and Leah R. Johnson. 2019.
<span>“Predicting the Fundamental Thermal Niche of Crop Pests and
Diseases in a Changing World: A Case Study on Citrus Greening.”</span>
<em>Journal of Applied Ecology</em> 56 (8): 2057–68. <a href="https://doi.org/10.1111/1365-2664.13455" class="external-link">https://doi.org/10.1111/1365-2664.13455</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Darío San-Segundo Molina, A. Márcia Barbosa, Antonio Jesús Pérez-Luque, Francisco Rodríguez-Sánchez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
